//
//  The MIT License
//
//  Copyright (c) 2014- High-Mobility GmbH (https://high-mobility.com)
//
//  Permission is hereby granted, free of charge, to any person obtaining a copy
//  of this software and associated documentation files (the "Software"), to deal
//  in the Software without restriction, including without limitation the rights
//  to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
//  copies of the Software, and to permit persons to whom the Software is
//  furnished to do so, subject to the following conditions:
//
//  The above copyright notice and this permission notice shall be included in
//  all copies or substantial portions of the Software.
//
//  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
//  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
//  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
//  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
//  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
//  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
//  THE SOFTWARE.
//
//
//  AACharging.swift
//  AutoAPI
//
//  Generated by AutoAPIGenerator for Swift.
//  Copyright Â© 2020 High-Mobility GmbH. All rights reserved.
//

import Foundation
import HMUtilities


public final class AACharging: AACapability, AAPropertyIdentifying {

    /// Information about the introduction and last update of this capability.
    public enum API: AAAPICurrent {
        /// Level (version) of *AutoAPI* when `AACharging` was introduced to the spec.
        public static let intro: UInt8 = 2
    
        /// Level (version) of *AutoAPI* when `AACharging` was last updated.
        public static let updated: UInt8 = 12
    }


    /// Charge mode enum.
    public enum ChargeMode: UInt8, CaseIterable, Codable, HMBytesConvertable {
        case immediate = 0x00
        case timerBased = 0x01
        case inductive = 0x02
    }

    /// Charging window chosen enum.
    public enum ChargingWindowChosen: UInt8, CaseIterable, Codable, HMBytesConvertable {
        case notChosen = 0x00
        case chosen = 0x01
    }

    /// Type of current in use.
    public enum CurrentType: UInt8, CaseIterable, Codable, HMBytesConvertable {
        case alternatingCurrent = 0x00
        case directCurrent = 0x01
    }

    /// Plug type enum.
    public enum PlugType: UInt8, CaseIterable, Codable, HMBytesConvertable {
        case type1 = 0x00
        case type2 = 0x01
        case ccs = 0x02
        case chademo = 0x03
    }

    /// Plugged in enum.
    public enum PluggedIn: UInt8, CaseIterable, Codable, HMBytesConvertable {
        case disconnected = 0x00
        case pluggedIn = 0x01
    }

    /// Preconditioning error if one is encountered.
    public enum PreconditioningError: UInt8, CaseIterable, Codable, HMBytesConvertable {
        case noChange = 0x00
        case notPossibleLow = 0x01
        case notPossibleFinished = 0x02
        case availableAfterEngineRestart = 0x03
        case generalError = 0x04
    }

    /// Status of optimized/intelligent charging.
    public enum SmartChargingStatus: UInt8, CaseIterable, Codable, HMBytesConvertable {
        case wallboxIsActive = 0x00
        case sccIsActive = 0x01
        case inactive = 0x02
    }

    /// State of the starter battery.
    public enum StarterBatteryState: UInt8, CaseIterable, Codable, HMBytesConvertable {
        case red = 0x00
        case yellow = 0x01
        case green = 0x02
    }

    /// Status enum.
    public enum Status: UInt8, CaseIterable, Codable, HMBytesConvertable {
        case notCharging = 0x00
        case charging = 0x01
        case chargingComplete = 0x02
        case initialising = 0x03
        case chargingPaused = 0x04
        case chargingError = 0x05
        case cableUnplugged = 0x06
        case slowCharging = 0x07
        case fastCharging = 0x08
        case discharging = 0x09
        case foreignObjectDetected = 0x0a
    }


    // MARK: Identifiers
    
    public class override var identifier: UInt16 { 0x0023 }


    /// Property identifiers for `AACharging`.
    public enum PropertyIdentifier: UInt8, CaseIterable {
        case estimatedRange = 0x02
        case batteryLevel = 0x03
        case chargeLimit = 0x08
        case timeToCompleteCharge = 0x09
        case chargePortState = 0x0b
        case chargeMode = 0x0c
        case maxChargingCurrent = 0x0e
        case plugType = 0x0f
        case chargingWindowChosen = 0x10
        case departureTimes = 0x11
        case reductionTimes = 0x13
        case batteryTemperature = 0x14
        case timers = 0x15
        case pluggedIn = 0x16
        case status = 0x17
        case chargingRate = 0x18
        case batteryCurrent = 0x19
        case chargerVoltage = 0x1a
        case currentType = 0x1b
        case maxRange = 0x1c
        case starterBatteryState = 0x1d
        case smartChargingStatus = 0x1e
        case batteryLevelAtDeparture = 0x1f
        case preconditioningDepartureStatus = 0x20
        case preconditioningImmediateStatus = 0x21
        case preconditioningDepartureEnabled = 0x22
        case preconditioningError = 0x23
    }


    // MARK: Properties
    
    /// Battery current.
    public var batteryCurrent: AAProperty<Measurement<UnitElectricCurrent>>?
    
    /// Battery level percentage between 0.0-1.0.
    public var batteryLevel: AAProperty<AAPercentage>?
    
    /// Battery charge level expected at time of departure.
    public var batteryLevelAtDeparture: AAProperty<AAPercentage>?
    
    /// Battery temperature.
    public var batteryTemperature: AAProperty<Measurement<UnitTemperature>>?
    
    /// Charge limit percentage between 0.0-1.0.
    public var chargeLimit: AAProperty<AAPercentage>?
    
    /// Charge mode value.
    public var chargeMode: AAProperty<ChargeMode>?
    
    /// Charge port state value.
    public var chargePortState: AAProperty<AAPosition>?
    
    /// Charger voltage.
    public var chargerVoltage: AAProperty<Measurement<UnitElectricPotentialDifference>>?
    
    /// Charge rate when charging.
    public var chargingRate: AAProperty<Measurement<UnitPower>>?
    
    /// Charging window chosen value.
    public var chargingWindowChosen: AAProperty<ChargingWindowChosen>?
    
    /// Type of current in use.
    public var currentType: AAProperty<CurrentType>?
    
    /// Departure times value.
    public var departureTimes: [AAProperty<AADepartureTime>]?
    
    /// Estimated range.
    public var estimatedRange: AAProperty<Measurement<UnitLength>>?
    
    /// Maximum charging current.
    public var maxChargingCurrent: AAProperty<Measurement<UnitElectricCurrent>>?
    
    /// Maximum electric range with 100% of battery.
    public var maxRange: AAProperty<Measurement<UnitLength>>?
    
    /// Plug type value.
    public var plugType: AAProperty<PlugType>?
    
    /// Plugged in value.
    public var pluggedIn: AAProperty<PluggedIn>?
    
    /// Preconditioning activation status at departure.
    public var preconditioningDepartureEnabled: AAProperty<AAEnabledState>?
    
    /// Status of preconditioning at departure time.
    public var preconditioningDepartureStatus: AAProperty<AAActiveState>?
    
    /// Preconditioning error if one is encountered.
    public var preconditioningError: AAProperty<PreconditioningError>?
    
    /// Status of immediate preconditioning.
    public var preconditioningImmediateStatus: AAProperty<AAActiveState>?
    
    /// Reduction of charging times value.
    public var reductionTimes: [AAProperty<AAReductionTime>]?
    
    /// Status of optimized/intelligent charging.
    public var smartChargingStatus: AAProperty<SmartChargingStatus>?
    
    /// State of the starter battery.
    public var starterBatteryState: AAProperty<StarterBatteryState>?
    
    /// Status value.
    public var status: AAProperty<Status>?
    
    /// Time until charging completed.
    public var timeToCompleteCharge: AAProperty<Measurement<UnitDuration>>?
    
    /// Timers value.
    public var timers: [AAProperty<AATimer>]?
    
    // Deprecated
    
    /// Battery alternating current.
    ///
    /// - warning: This property is deprecated in favour of *batteryCurrent*.
    @available(*, deprecated, renamed: "batteryCurrent", message: "moved AC/DC distinction into a separate property")
    public var batteryCurrentAC: AAProperty<Measurement<UnitElectricCurrent>>? {
        batteryCurrent
    }
    
    /// Battery direct current.
    ///
    /// - warning: This property is deprecated in favour of *batteryCurrent*.
    @available(*, deprecated, renamed: "batteryCurrent", message: "moved AC/DC distinction into a separate property")
    public var batteryCurrentDC: AAProperty<Measurement<UnitElectricCurrent>>? {
        batteryCurrent
    }
    
    /// Charger voltage for alternating current.
    ///
    /// - warning: This property is deprecated in favour of *chargerVoltage*.
    @available(*, deprecated, renamed: "chargerVoltage", message: "moved AC/DC distinction into a separate property")
    public var chargerVoltageAC: AAProperty<Measurement<UnitElectricPotentialDifference>>? {
        chargerVoltage
    }
    
    /// Charger voltage for direct current.
    ///
    /// - warning: This property is deprecated in favour of *chargerVoltage*.
    @available(*, deprecated, renamed: "chargerVoltage", message: "moved AC/DC distinction into a separate property")
    public var chargerVoltageDC: AAProperty<Measurement<UnitElectricPotentialDifference>>? {
        chargerVoltage
    }
    
    /// Charging rate.
    ///
    /// - warning: This property is deprecated in favour of *chargingRate*.
    @available(*, deprecated, renamed: "chargingRate", message: "removed the unit from the name")
    public var chargingRateKW: AAProperty<Measurement<UnitPower>>? {
        chargingRate
    }


    // MARK: Getters
    
    /// Get `AACharging` state (all properties).
    ///
    /// - returns: The request as `[UInt8]` to send to the vehicle.
    public static func getChargingState() -> [UInt8] {
        AAAutoAPI.protocolVersion.bytes + Self.identifier.bytes + AACommandType.get.rawValue.bytes
    }
    
    /// Get `AACharging` state's specific properties.
    ///
    /// - parameters:
    ///     - ids: List of property identifiers to request.
    ///
    /// - returns: The request as `[UInt8]` to send to the vehicle.
    public static func getChargingStateProperties(ids: PropertyIdentifier...) -> [UInt8] {
        getChargingState() + ids.map { $0.rawValue }
    }
    
    /// Get `AACharging` state properties availability.
    ///
    /// - returns: The request as `[UInt8]` to send to the vehicle.
    public static func getChargingStateAvailability() -> [UInt8] {
        AAAutoAPI.protocolVersion.bytes + Self.identifier.bytes + AACommandType.availability.rawValue.bytes
    }
    
    /// Get `AACharging` state's specific properties' availability.
    ///
    /// - parameters:
    ///     - ids: List of property identifiers to request availability for.
    ///
    /// - returns: The request as `[UInt8]` to send to the vehicle.
    public static func getChargingStatePropertiesAvailability(ids: PropertyIdentifier...) -> [UInt8] {
        getChargingStateAvailability() + ids.map { $0.rawValue }
    }


    // MARK: Setters
    
    /// Start or stop charging, which can only be controlled when the vehicle is plugged in.
    /// 
    /// - parameters:
    ///     - status: Status value.
    ///
    /// - returns: Command as `[UInt8]` to send to the vehicle.
    public static func startStopCharging(status: Status) -> [UInt8] {
        var properties: [AAOpaqueProperty?] = []
    
        properties.append(AAProperty(id: PropertyIdentifier.status, value: status))
    
        let propertiesBytes = properties.compactMap { $0 }.sorted { $0.id < $1.id }.flatMap { $0.bytes }
    
        return setterHeader + propertiesBytes
    }
    
    /// Set the charge limit, to which point the vehicle will charge itself.
    /// 
    /// - parameters:
    ///     - chargeLimit: Charge limit percentage between 0.0-1.0.
    ///
    /// - returns: Command as `[UInt8]` to send to the vehicle.
    public static func setChargeLimit(chargeLimit: AAPercentage) -> [UInt8] {
        var properties: [AAOpaqueProperty?] = []
    
        properties.append(AAProperty(id: PropertyIdentifier.chargeLimit, value: chargeLimit))
    
        let propertiesBytes = properties.compactMap { $0 }.sorted { $0.id < $1.id }.flatMap { $0.bytes }
    
        return setterHeader + propertiesBytes
    }
    
    /// Open or close the charge port of the vehicle.
    /// 
    /// - parameters:
    ///     - chargePortState: Charge port state value.
    ///
    /// - returns: Command as `[UInt8]` to send to the vehicle.
    public static func openCloseChargingPort(chargePortState: AAPosition) -> [UInt8] {
        var properties: [AAOpaqueProperty?] = []
    
        properties.append(AAProperty(id: PropertyIdentifier.chargePortState, value: chargePortState))
    
        let propertiesBytes = properties.compactMap { $0 }.sorted { $0.id < $1.id }.flatMap { $0.bytes }
    
        return setterHeader + propertiesBytes
    }
    
    /// Set the charge mode of the vehicle.
    /// 
    /// - parameters:
    ///     - chargeMode: Charge mode value.
    ///
    /// - returns: Command as `[UInt8]` to send to the vehicle.
    public static func setChargeMode(chargeMode: ChargeMode) -> [UInt8] {
        var properties: [AAOpaqueProperty?] = []
    
        properties.append(AAProperty(id: PropertyIdentifier.chargeMode, value: chargeMode))
    
        let propertiesBytes = properties.compactMap { $0 }.sorted { $0.id < $1.id }.flatMap { $0.bytes }
    
        return setterHeader + propertiesBytes
    }
    
    /// Set the charging timers of the vehicle. The command can include one of the different timer types or all.
    /// 
    /// - parameters:
    ///     - timers: Timers value.
    ///
    /// - returns: Command as `[UInt8]` to send to the vehicle.
    public static func setChargingTimers(timers: [AATimer]) -> [UInt8] {
        var properties: [AAOpaqueProperty?] = []
    
        properties.append(contentsOf: timers.compactMap { AAProperty(id: PropertyIdentifier.timers, value: $0) })
    
        let propertiesBytes = properties.compactMap { $0 }.sorted { $0.id < $1.id }.flatMap { $0.bytes }
    
        return setterHeader + propertiesBytes
    }
    
    /// Set the reduction of charging times of the vehicle. The command can include different values for start and stop.
    /// 
    /// - parameters:
    ///     - reductionTimes: Reduction of charging times value.
    ///
    /// - returns: Command as `[UInt8]` to send to the vehicle.
    public static func setReductionOfChargingCurrentTimes(reductionTimes: [AAReductionTime]) -> [UInt8] {
        var properties: [AAOpaqueProperty?] = []
    
        properties.append(contentsOf: reductionTimes.compactMap { AAProperty(id: PropertyIdentifier.reductionTimes, value: $0) })
    
        let propertiesBytes = properties.compactMap { $0 }.sorted { $0.id < $1.id }.flatMap { $0.bytes }
    
        return setterHeader + propertiesBytes
    }


    // MARK: AACapability
    
    public required init?(bytes: [UInt8]) {
        super.init(bytes: bytes)
    
        batteryCurrent = extract(property: .batteryCurrent)
        batteryLevel = extract(property: .batteryLevel)
        batteryLevelAtDeparture = extract(property: .batteryLevelAtDeparture)
        batteryTemperature = extract(property: .batteryTemperature)
        chargeLimit = extract(property: .chargeLimit)
        chargeMode = extract(property: .chargeMode)
        chargePortState = extract(property: .chargePortState)
        chargerVoltage = extract(property: .chargerVoltage)
        chargingRate = extract(property: .chargingRate)
        chargingWindowChosen = extract(property: .chargingWindowChosen)
        currentType = extract(property: .currentType)
        departureTimes = extract(properties: .departureTimes)
        estimatedRange = extract(property: .estimatedRange)
        maxChargingCurrent = extract(property: .maxChargingCurrent)
        maxRange = extract(property: .maxRange)
        plugType = extract(property: .plugType)
        pluggedIn = extract(property: .pluggedIn)
        preconditioningDepartureEnabled = extract(property: .preconditioningDepartureEnabled)
        preconditioningDepartureStatus = extract(property: .preconditioningDepartureStatus)
        preconditioningError = extract(property: .preconditioningError)
        preconditioningImmediateStatus = extract(property: .preconditioningImmediateStatus)
        reductionTimes = extract(properties: .reductionTimes)
        smartChargingStatus = extract(property: .smartChargingStatus)
        starterBatteryState = extract(property: .starterBatteryState)
        status = extract(property: .status)
        timeToCompleteCharge = extract(property: .timeToCompleteCharge)
        timers = extract(properties: .timers)
    }
}